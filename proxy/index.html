<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>tor-wasm Solidarity Bridge</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a2e;
      color: #e0e0e0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
    }
    .container { max-width: 600px; width: 100%; }
    h1 { font-size: 24px; margin-bottom: 8px; color: #7c3aed; }
    .subtitle { color: #999; margin-bottom: 32px; font-size: 14px; }
    .card {
      background: #16213e;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
      border: 1px solid #2a2a4a;
    }
    .status-display {
      text-align: center;
      padding: 32px;
    }
    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 8px;
      background: #666;
    }
    .status-waiting .status-dot { background: #22c55e; animation: pulse 2s infinite; }
    .status-relaying .status-dot { background: #3b82f6; animation: pulse 1s infinite; }
    .status-connecting .status-dot,
    .status-connecting-client .status-dot { background: #f59e0b; }
    .status-error .status-dot,
    .status-disconnected .status-dot { background: #ef4444; }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    #status { font-size: 18px; font-weight: 500; }
    #stats { color: #999; margin-top: 8px; font-size: 14px; }
    label { display: block; font-size: 13px; color: #999; margin-bottom: 4px; }
    input {
      width: 100%;
      padding: 10px 12px;
      background: #0f3460;
      border: 1px solid #2a2a4a;
      border-radius: 8px;
      color: #e0e0e0;
      font-size: 14px;
      margin-bottom: 12px;
    }
    input:focus { outline: none; border-color: #7c3aed; }
    button {
      width: 100%;
      padding: 12px;
      background: #7c3aed;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      font-weight: 500;
    }
    button:hover { background: #6d28d9; }
    button:disabled { background: #444; cursor: not-allowed; }
    .info {
      font-size: 13px;
      color: #888;
      line-height: 1.6;
    }
    .info strong { color: #aaa; }
    #log {
      max-height: 150px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      color: #666;
      padding: 8px;
      background: #0a0a1a;
      border-radius: 8px;
      margin-top: 12px;
    }
    #log div { padding: 2px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Solidarity Bridge</h1>
    <p class="subtitle">Help censored users access the open internet. No installation required.</p>

    <div class="card status-display">
      <div id="status-container">
        <span class="status-dot"></span>
        <span id="status">Idle</span>
      </div>
      <div id="stats"></div>
    </div>

    <div class="card">
      <label for="broker-url">Broker URL</label>
      <input type="text" id="broker-url" value="wss://broker.example.com" placeholder="wss://broker.example.com">

      <label for="bridge-url">Bridge URL</label>
      <input type="text" id="bridge-url" value="wss://bridge.example.com" placeholder="wss://bridge.example.com">

      <button id="start-btn" onclick="handleStart()">Start Volunteering</button>
    </div>

    <div class="card info">
      <strong>How it works:</strong> Your browser tab creates a WebRTC connection
      that censored users can use to reach the Tor network. You relay encrypted bytes
      â€” you cannot see what they're browsing. The connection looks like a video call
      to network monitoring equipment.
      <br><br>
      <strong>What you see:</strong> Encrypted bytes flowing through your browser.
      <br>
      <strong>What you don't see:</strong> Websites visited, messages sent, user identity.
      <br><br>
      <strong>Bandwidth:</strong> Tor traffic uses ~50-200 KB/s per user. Your tab
      can serve one user at a time.
      <div id="log"></div>
    </div>
  </div>

  <script src="proxy.js"></script>
  <script>
    function handleStart() {
      const brokerUrl = document.getElementById('broker-url').value;
      const bridgeUrl = document.getElementById('bridge-url').value;

      if (!brokerUrl || !bridgeUrl) {
        alert('Please enter both broker and bridge URLs');
        return;
      }

      document.getElementById('start-btn').disabled = true;
      document.getElementById('start-btn').textContent = 'Running...';

      startProxy(brokerUrl, bridgeUrl);
    }
  </script>
</body>
</html>
